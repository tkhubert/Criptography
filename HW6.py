__author__ = 'tkhubert'

from CryptoImport import *
import gmpy2
from gmpy2 import mpz, isqrt, gcdext


N1 = mpz('179769313486231590772930519078902473361797697894230657273430081157732675805505620686985379449212982959585501387537164015710139858647833778606925583497541085196591615128057575940752635007475935288710823649949940771895617054361149474865046711015101563940680527540071584560878577663743040086340742855278549092581')
N2 = mpz('648455842808071669662824265346772278726343720706976263060439070378797308618081116462714015276061417569195587321840254520655424906719892428844841839353281972988531310511738648965962582821502504990264452100885281673303711142296421027840289307657458645233683357077834689715838646088239640236866252211790085787877')
N3 = mpz('720062263747350425279564435525583738338084451473999841826653057981916355690188337790423408664187663938485175264994017897083524079135686877441155132015188279331812309091996246361896836573643119174094961348524639707885238799396839230364676670221627018353299443241192173812729276147530748597302192751375739387929')
c  = mpz('22096451867410381776306561134883418017410069787892831071731839143676135600120538004282329650473509424343946219751512256465839967942889460764542040581564748988013734864120452325229320176487916666402997509188729971690526083222067771600019329260870009579993724077458967773697817571267229951148662959627934791540')

def main():
    print 'Challenge 1'
    A = isqrt(N1)+1
    x = isqrt(A*A-N1)
    p = A-x
    q = A+x
    phiN = mpz(p-1)*mpz(q-1)
    print 'p: ', p
    print 'q: ', q
    print 'Check: ', p*q==N1
    print

    print 'Challenge 2'
    A0 = isqrt(N2)+1
    AN = A0 + 2**20
    for A in range(A0, AN):
        x = isqrt(A*A-N2)
        p = A-x
        q = A+x
        if (p*q==N2):
            break
    print 'p: ', p
    print 'q: ', q
    print 'Check: ', p*q==N2
    print

    print 'Challenge 3'
    N3_p = 24*N3
    A    = isqrt(24*N3)+1
    x = isqrt(A*A-N3_p)
    p_p = A-x
    q_p = A+x
    p   = p_p/6
    q   = q_p/4

    print 'p: ', p
    print 'q: ', q
    print 'Check: ', p*q==N3
    print

    print 'Challenge 4'
    e = mpz('65537')
    [g, d, dummy] = gcdext(e, phiN)
    m = gmpy2.powmod(c,d,N1)
    m = hex(m)
    m = m[-56:]
    print m
    print unhexlify(m)

if __name__ == "__main__":
    main()